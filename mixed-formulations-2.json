{"version":2,"kind":"Notebook","sha256":"93d446043ebda5de9ee7bea642565a57c9926ca563a38aecb5b41280e3c669a9","slug":"mixed-formulations-2","location":"/FEniCSx/mixed_formulations_2.ipynb","dependencies":[],"frontmatter":{"title":"Implementation","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/Navier-Geotechnique/fenicsx-mfront-gallery","math":{"\\tens":{"macro":"\\underline{\\underline{#1}}"}},"numbering":{"title":{"offset":2}},"source_url":"https://github.com/Navier-Geotechnique/fenicsx-mfront-gallery/blob/main/FEniCSx/mixed_formulations_2.ipynb","edit_url":"https://github.com/Navier-Geotechnique/fenicsx-mfront-gallery/edit/main/FEniCSx/mixed_formulations_2.ipynb","exports":[{"format":"ipynb","filename":"mixed_formulations_2.ipynb","url":"/build/mixed_formulations_2-2514edb57bad6735aab7a01227f8926c.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import ufl\nfrom dolfinx import mesh, fem, io, default_scalar_type, plot\nfrom dolfinx.fem.petsc import LinearProblem\nfrom mpi4py import MPI\nimport numpy as np\nimport basix\nimport pyvista\npyvista.set_jupyter_backend('static')\n\n# Mesh\ndomain = mesh.create_unit_square(\n    MPI.COMM_WORLD, 8, 8\n)  # coarse to exaggerate oscillations\n\n# Elements\norder = 2\nV_el = basix.ufl.element(\"BDM\", domain.basix_cell(), order)  # flux q\nP_el = basix.ufl.element(\"DG\", domain.basix_cell(), order - 1)  # pressure p\nW = fem.functionspace(domain, basix.ufl.mixed_element([V_el, P_el]))\n\n(q, p) = ufl.TrialFunctions(W)\n(q_, p_) = ufl.TestFunctions(W)\n\n# Material\nkappa = 1e-10  # very low permeability\nmu_f = 1.0  # fluid viscosity\n\n\n# Boundary conditions: pressure on left/right\ndef left(x):\n    return np.isclose(x[0], 0.0)\n\n\ndef right(x):\n    return np.isclose(x[0], 1.0)\n\n\ndef top(x):\n    return np.isclose(x[1], 1.0)\n\n\ndef bottom(x):\n    return np.isclose(x[1], 0.0)\n\n\nleft_facets = mesh.locate_entities_boundary(domain, 1, left)\nright_facets = mesh.locate_entities_boundary(domain, 1, right)\ntop_facets = mesh.locate_entities_boundary(domain, 1, top)\nbottom_facets = mesh.locate_entities_boundary(domain, 1, bottom)\nQ, _ = W.sub(0).collapse()\ntop_dofs_q = fem.locate_dofs_topological((W.sub(0), Q), 1, top_facets)\nbottom_dofs_q = fem.locate_dofs_topological((W.sub(0), Q), 1, bottom_facets)\n\nbc_top = fem.dirichletbc(fem.Function(Q), top_dofs_q, W.sub(0))\nbc_bottom = fem.dirichletbc(fem.Function(Q), bottom_dofs_q, W.sub(0))\n\nfacet_tags = mesh.meshtags(domain, 1, left_facets, np.full_like(left_facets, 1))\nds = ufl.Measure(\"ds\", domain=domain, subdomain_data=facet_tags)\n\n# Weak form (Darcy)\na = (\n    ufl.inner((mu_f / kappa) * q, q_) * ufl.dx\n    - ufl.inner(p, ufl.div(q_)) * ufl.dx\n    + ufl.inner(ufl.div(q), p_) * ufl.dx\n)\nn = ufl.FacetNormal(domain)\nL = -ufl.inner(fem.Constant(domain, default_scalar_type(2.0)), ufl.dot(q_, n)) * ds(1)\n\nbcs = [bc_top, bc_bottom]\n\n# Solve\nproblem = LinearProblem(a, L, bcs=bcs)\nw = problem.solve()\nCG1 = fem.functionspace(domain, (\"CG\", 1))\np_h = fem.Function(CG1, name=\"Pressure\")\np_h.interpolate(w.sub(1).collapse())\n\npyvista.start_xvfb()\nu_topology, u_cell_types, u_geometry = plot.vtk_mesh(CG1)\nu_grid = pyvista.UnstructuredGrid(u_topology, u_cell_types, u_geometry)\nu_grid.point_data[\"u\"] = p_h.x.array.real\nu_grid.set_active_scalars(\"u\")\nu_plotter = pyvista.Plotter()\nu_plotter.add_mesh(u_grid, show_edges=True)\nu_plotter.view_xy()\nu_plotter.show()","key":"hvSnusPSTx"},{"type":"output","id":"rEQWDQIBF43CcuPT-JQRU","data":[{"output_type":"display_data","metadata":{},"data":{"image/jpeg":{"content_type":"image/jpeg","hash":"f30546988182c658ebd5a5544f5f962c","path":"/build/f30546988182c658ebd5a5544f5f962c.jpeg"},"image/png":{"content_type":"image/png","hash":"6fab7862df463282b21f3cd0e4fd66f8","path":"/build/6fab7862df463282b21f3cd0e4fd66f8.png"},"text/plain":{"content":"<PIL.Image.Image image mode=RGB size=1024x768>","content_type":"text/plain"}}}],"key":"oAgeL8kW2f"}],"key":"CGFmHI9B2a"}],"key":"SYC5BwWKMW"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Why mixed formulations ?","url":"/mixed-formulations","group":"Mixed Formulations"},"next":{"title":"Introduction","url":"/introduction-2","group":"Demos coupling FEniCSx & MFront"}}},"domain":"http://localhost:3000"}