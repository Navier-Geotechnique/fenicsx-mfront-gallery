{"version":2,"kind":"Notebook","sha256":"74bc45886efd3c3136b9f8cd20de11f77b4f7be5e2228219f5792c9e35f4f8bb","slug":"poroelasticity-2","location":"/FEniCSx_Mfront/2_Poroelasticity/poroelasticity.ipynb","dependencies":[],"frontmatter":{"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/Navier-Geotechnique/fenicsx-mfront-gallery","math":{"\\tens":{"macro":"\\underline{\\underline{#1}}"}},"numbering":{"title":{"offset":1}},"source_url":"https://github.com/Navier-Geotechnique/fenicsx-mfront-gallery/blob/main/FEniCSx_Mfront/2_Poroelasticity/poroelasticity.ipynb","edit_url":"https://github.com/Navier-Geotechnique/fenicsx-mfront-gallery/edit/main/FEniCSx_Mfront/2_Poroelasticity/poroelasticity.ipynb","exports":[{"format":"ipynb","filename":"poroelasticity.ipynb","url":"/fenicsx-mfront-gallery/build/poroelasticity-639347bedaef948da34b595c73cac72d.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from dolfinx import mesh, fem, default_scalar_type, io\nimport ufl\nimport basix\nfrom dolfinx.cpp.nls.petsc import NewtonSolver\nfrom mpi4py import MPI\nfrom petsc4py import PETSc\nimport numpy as np\nfrom dolfinx_materials.quadrature_map import QuadratureMap\nfrom dolfinx_materials.solvers import NonlinearMaterialProblem\nfrom dolfinx_materials.material.mfront import MFrontMaterial\nfrom dolfinx_materials.utils import symmetric_tensor_to_vector\nimport os\ncurrent_path = os.getcwd()\n\n\nL, H = 0.1, 0.1\nNx, Ny = 20, 20\n\ndomain = mesh.create_rectangle(MPI.COMM_WORLD, [[0,0], [L,H]], [Nx,Ny], mesh.CellType.quadrilateral)\nx = ufl.SpatialCoordinate(domain)\ndef axi_grad(u):\n    return ufl.as_vector([u[0].dx(0), u[1].dx(1), u[0]/x[0], (u[0].dx(1)+u[1].dx(0))/2])","key":"v8s52vdCFG"},{"type":"output","id":"nwjHGdaGGAxnyM7UxhQb3","data":[],"key":"hEFbCkrHxe"}],"key":"BpvT8wo2B3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"mat_prop = {\n    \"YoungModulus\": 6e9,\n    \"PoissonRatio\": 0.2,\n    \"BiotCoefficient\": 0.6,\n    \"BiotN\": 3.1e10,\n    \"LiquidPermeability\": 5e-16,\n    \"InitialPorosity\": 0.2,\n}\nmaterial = MFrontMaterial(\n    os.path.join(current_path, \"src/libBehaviour.so\"),\n    \"PoroElasticity_Maxime\",\n    hypothesis=\"plane_strain\",\n    material_properties = mat_prop,\n)","key":"CzAWEonHnZ"},{"type":"output","id":"MZscy9r7UE0jQAgwz1zpm","data":[],"key":"TGc3mZpRzf"}],"key":"WErFqYpbw6"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"disp_el = basix.ufl.element(\"Lagrange\", domain.basix_cell(), 1, shape=(2,))\nfluid_el = basix.ufl.element(\"Lagrange\", domain.basix_cell(), 1)\nV = fem.functionspace(domain, basix.ufl.mixed_element([disp_el, fluid_el]))\nv = fem.Function(V, name=\"Unknown\")\n\ndef bottom(x):\n    return np.isclose(x[1], 0)\ndef top(x):\n    return np.isclose(x[1], H)\ndef left(x):\n    return np.isclose(x[0], 0)\n\n\nbottom_facets = mesh.locate_entities_boundary(domain, 1, bottom)\nbottom_dofs_y = fem.locate_dofs_topological(V.sub(0).sub(1), 1, bottom_facets)\ntop_facets = mesh.locate_entities_boundary(domain, 1, top)\npf_ini = 0e6\ntop_dofs_pf = fem.locate_dofs_topological(V.sub(1), 1, top_facets)\nbc_pf_top = fem.dirichletbc(pf_ini, top_dofs_pf, V.sub(1))\n\nbcs = [\n    fem.dirichletbc(default_scalar_type(0), bottom_dofs_y, V.sub(0).sub(1)),\n    bc_pf_top\n]\n\nfacet_tags = mesh.meshtags(domain, 1, top_facets, np.full_like(top_facets, 1))\n\nds = ufl.Measure(\"ds\", domain=domain, subdomain_data=facet_tags, metadata={\"quadrature degree\": 2})\nf = fem.Constant(domain, np.zeros((2,)))","key":"GxBMcVcARS"},{"type":"output","id":"4yUZVetavAoDnOaF791Mf","data":[],"key":"JhQgciVj8e"}],"key":"Ubu8dNFTpB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"qmap = QuadratureMap(domain, 2, material)","key":"nvat3UTaTH"},{"type":"output","id":"vyIqtGTYSncj6oBxL9vpt","data":[],"key":"YWXreuWoM6"}],"key":"P1jbqgX7Ze"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"(u, pl) = ufl.split(v)\nqmap.register_gradient(\"Strain\", symmetric_tensor_to_vector(ufl.sym(ufl.grad(u))))\nqmap.register_external_state_variable(\"LiquidPressure\", pl)\nqmap.register_gradient(\"LiquidPressureGradient\", ufl.grad(pl))","key":"BjGh3up1dN"},{"type":"output","id":"w4DjupMBP0PlXkmRasxGu","data":[],"key":"zQhJGKTsOJ"}],"key":"qUosRXmJng"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"sig = qmap.fluxes[\"Stress\"]\nw = qmap.fluxes[\"FluidFlux\"]\nml = qmap.internal_state_variables[\"LiquidMass\"]\nml_n = ml.copy()\ndt = fem.Constant(domain, 0.0)","key":"vRyY8zgTVf"},{"type":"output","id":"YM0YJFYTLG2jw16MOefAl","data":[],"key":"SJkPw1PcKe"}],"key":"i2tHrbs1TK"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"v_ = ufl.TestFunction(V)\n(u_, pl_) = ufl.split(v_)\ndv = ufl.TrialFunction(V)","key":"jWkkhmtmT8"},{"type":"output","id":"JH5mucIV7OTxR2Ltqnb81","data":[],"key":"MrMJ8pGejp"}],"key":"IeXn8ZM9of"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"F = (ufl.dot(sig, symmetric_tensor_to_vector(ufl.sym(ufl.grad(u_))))) * qmap.dx + ( (ml-ml_n)/dt*pl_ - ufl.dot(w, ufl.grad(pl_)))*qmap.dx -ufl.dot(f, u_)*ds(1)","key":"p00FNHQtaP"},{"type":"output","id":"oWPixrobFw3EtOf9boWrD","data":[],"key":"fuBndiH3e9"}],"key":"K1Q6OFiQ6v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Jac = qmap.derivative(F, v, dv)","key":"y0abdX7Au4"},{"type":"output","id":"6E1lCf1fFwCHoKwKUWZpK","data":[],"key":"NY4H0KwjhI"}],"key":"Fji6dBozDa"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"problem = NonlinearMaterialProblem(qmap, F, Jac, v, bcs)","key":"sk2J8V0l4a"},{"type":"output","id":"iUr6Cn35TtaFqyzzRG_cz","data":[],"key":"vuTVd40EBw"}],"key":"QRpJygLNzp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"qmap.update()\nml.x.petsc_vec.copy(ml_n.x.petsc_vec)","key":"YKCFJobc2o"},{"type":"output","id":"Mr_GYi8PcpfuuKshehRv6","data":[],"key":"pfzRgJaHIR"}],"key":"lOZOnWz8vz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"newton = NewtonSolver(MPI.COMM_WORLD)\nnewton.rtol = 1e-6\nnewton.atol = 1e-6\nnewton.convergence_criterion = \"incremental\"\nnewton.report = True\nnewton.max_it = 50","key":"XAImWy75zM"},{"type":"output","id":"NVvmjp_JHMkrRkl_arNh1","data":[],"key":"gRUC2Xbou1"}],"key":"r81r0Pkm06"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"Nincr = 20\nload_steps = np.linspace(0.0, 1.0, Nincr + 1)\n\nvtk_u = io.VTKFile(domain.comm, \"results/results_u.pvd\", \"w\")\nvtk_p = io.VTKFile(domain.comm, \"results/results_p.pvd\", \"w\")\nvtk_sig = io.VTKFile(domain.comm, \"results/results_sig.pvd\", \"w\")\nfor i, t in enumerate(load_steps[1:]):\n    f.value[-1] = -1e7 * t\n    dt.value = 1/Nincr\n\n    converged, it = problem.solve(newton, print_solution=True)\n    ml.x.petsc_vec.copy(ml_n.x.petsc_vec)\n    u_out = v.sub(0).collapse()\n    u_out.name = \"Displacement\"\n    p_out = v.sub(1).collapse()\n    p_out.name = \"Pressure\"\n    stress_out = qmap.project_on(\"Stress\", (\"DG\",0))\n    vtk_u.write_function(u_out, t)\n    vtk_p.write_function(p_out, t)\n    vtk_sig.write_function(stress_out, t)\n\nvtk_u.close()\nvtk_p.close()\nvtk_sig.close()","key":"VvFmRoOlcN"},{"type":"output","id":"1fffU4VoSesB3yLZ03fGl","data":[],"key":"Kllkea8Mw8"}],"key":"exN2KpC7sr"}],"key":"FizFVQvhOT"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Stationary nonlinear heat transfer","url":"/nonlinear-heat-transfer","group":"Demos coupling FEniCSx & MFront"}}},"domain":"http://localhost:3000"}